{
	"info": {
		"_postman_id": "853b6969-a93a-4d62-b2d5-b41e30de5385",
		"name": "UGC",
		"description": "The UGC backend is divided into two individual APIs:\n\n- User Management (incl. Chat and Channel endpoints)\n- Metrics",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "20287494"
	},
	"item": [
		{
			"name": "User Management",
			"item": [
				{
					"name": "Chat",
					"item": [
						{
							"name": "/user/chatToken/create",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"const { token: privateToken } = JSON.parse(responseBody);",
											"",
											"if (privateToken) {",
											"    pm.environment.set('secureWebSocketProtocolToken', privateToken);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "",
										"value": "",
										"type": "text",
										"disabled": true
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"chatRoomOwnerUsername\": \"{{username}}\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{apiBaseUrl}}/user/chatToken/create",
									"host": [
										"{{apiBaseUrl}}"
									],
									"path": [
										"user",
										"chatToken",
										"create"
									]
								},
								"description": "This endpoint will generate an IVS chat room token that can be used to establish a connection with the Amazon IVS Chat Messaging API. Specifically, the token can connect a user to an IVS chat room, whether that be their own chat room or that of another user's.\n\nIf the token is not used to establish a connection before the expiration time lapses, the token becomes invalid. Tokens are valid for one minute from the time of creation and can only be used one time to establish a connection.\n\nThe established connection, or \"session\", remains active for 60 minutes, at which point it is automatically terminated by the Amazon IVS Chat Messaging API. Once the session expires, a new token must be generated to establish a new connection.\n\nThe generated token can have a set of capabilities associated with it, providing it with certain permissions. The permission to view messages is implicitly provided with all generated tokens.\n\nIf a **valid** access token is provided with the request, then the token will be generated with the SEND_MESSAGE capability. In the instance that the token corresponds to the user's own chat room, additional DELETE_MESSAGE and DISCONNECT_USER moderation capabilities are attached to the token.\n\nIf no access token is provided with the request, then the token will be generated with no additional permissions other than the implicit permission to view messages."
							},
							"response": []
						}
					],
					"description": "This folder provides operations used to manage the user's IVS chat room resource."
				},
				{
					"name": "Channel",
					"item": [
						{
							"name": "/user/channel/:channelOwnerUsername",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{apiBaseUrl}}/user/channel/:channelOwnerUsername",
									"host": [
										"{{apiBaseUrl}}"
									],
									"path": [
										"user",
										"channel",
										":channelOwnerUsername"
									],
									"variable": [
										{
											"key": "channelOwnerUsername",
											"value": "{{username}}"
										}
									]
								},
								"description": "This unauthenticated endpoint fetches a set of channel-related data fields stored in the DynamoDB User table for the **requested** channel owner.\n\nIf the requesting user, or \"viewer\", is banned from the channel, then no stream-related data is returned as part of the response (i.e. `isLive` and `playbackUrl` are omitted from the response)."
							},
							"response": []
						},
						{
							"name": "/user/streamKey/reset",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{apiBaseUrl}}/user/streamKey/reset",
									"host": [
										"{{apiBaseUrl}}"
									],
									"path": [
										"user",
										"streamKey",
										"reset"
									]
								},
								"description": "This endpoint will destroy the existing stream key and create a new one."
							},
							"response": []
						},
						{
							"name": "/user/channel/ban",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"bannedUsername\": \"{{bannedUsername}}\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{apiBaseUrl}}/user/channel/ban",
									"host": [
										"{{apiBaseUrl}}"
									],
									"path": [
										"user",
										"channel",
										"ban"
									]
								},
								"description": "This endpoint is used to ban a user from a channel.\n\nOnce a user is banned from a channel, they are immediately disconnected from the chat room and an event is broadcasted to all users to delete all messages sent by the banned user to the chat room.\n\nAdditionally, a chat token request made by a banned user will result in a **403 Forbidden** response. Lastly, requests made by a banned user to retrieve channel data are allowed but the response will not include stream-related data (i.e. `isLive` and `playbackUrl` are omitted from the response) in order to prohibit them from watching a livestream on that channel.\n\nNote that a user is not allowed to ban themselves from their own channel."
							},
							"response": []
						},
						{
							"name": "/user/channel/unban",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"bannedUsername\": \"{{bannedUsername}}\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{apiBaseUrl}}/user/channel/unban",
									"host": [
										"{{apiBaseUrl}}"
									],
									"path": [
										"user",
										"channel",
										"unban"
									]
								},
								"description": "This endpoint is used to unban a user from a channel.\n\nOnce a user is unbanned from a channel, they will be permitted to request chat tokens and retrieve stream-related data (i.e. `isLive` and `playbackUrl`) from the channel info endpoint."
							},
							"response": []
						},
						{
							"name": "/user/channel/actions/send",
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"metadata\": \"N4IgdghgtgpiBcIDGMA2MBGAnCAXAlgPZggA0IAJnhAqBQK44HEICMADAL6dA===\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{apiBaseUrl}}/user/channel/actions/send",
									"host": [
										"{{apiBaseUrl}}"
									],
									"path": [
										"user",
										"channel",
										"actions",
										"send"
									]
								},
								"description": "This endpoint is used to send a stream action as a timed metadata event to the user's channel.\n\nSample product action:\n\n```\n\"N4IgdghgtgpiBcIAOAnA9gEwK4GMAuIANCBhHhAqHgJZ4A2ciAymDBANYwoDORJM3HCmpIaaMAhABNNFhQACbnhRtYKAOTd5AMwgA3NMLwxFrDl17FU1HIxAASAEwBWAAx9qUCAHMYAVRQ6SQALPDwkbngAeiiIJGoAOjpDGCgE7iQIWyjPHxgo7mC0AQB+AHcAXgBGV0cAFgAyYOraupAAX3agA\"\n\n```\n\nSample quiz action:\n\n```\n\"N4IgdghgtgpiBcICOBXAlgLxAGhAEwgBcIFQ8UAnItAezAQEYAGXVGAZ0NvsQHUALIgAJ+NFOxhDhACRoBzAO4QKhdkLw0OQ6cooBPIQCMYAGzpyhhGgH4cIAMY0KFGPcIBBMOwUwKASTA8GAAPRlwILx8KdgQAbRAAZRM9Qn5fNHpcAHF9ADNcjI0KO2kUfJMYAAcy3LsAJQgANxgwexMIBRAAXQBfHqA==\"\n\n```\n\nSample celebration action:\n\n```\n\"N4IgdghgtgpiBcIDGMA2MBGAnCAXAlgPZggA0IAJnhAqBQK44HEICMADAL6dA===\"\n\n```\n\nCancel any action:\n\n```\n\"{}\"\n\n```"
							},
							"response": []
						}
					],
					"description": "This folder provides operations used to manage the user's IVS channel resource."
				},
				{
					"name": "/user/register",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"avatar\": \"{{avatar}}\",\n    \"color\": \"{{color}}\",\n    \"email\": \"{{userEmail}}\",\n    \"password\": \"{{password}}\",\n    \"username\": \"{{username}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{apiBaseUrl}}/user/register",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"user",
								"register"
							]
						},
						"description": "This endpoint creates a new user in the Cognito user pool. This new user will be auto verified in stage `dev`. In stage `prod`, the registration process requires the user to confirm their email."
					},
					"response": []
				},
				{
					"name": "/user/resources/create",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{userEmail}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{apiBaseUrl}}/user/resources/create",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"user",
								"resources",
								"create"
							]
						},
						"description": "This endpoint creates the following resources for the corresponding user account:\n\n*   an IVS channel\n*   a DynamoDB record with the user's account information and channel details\n    \n\nIt should only be called once, particularly when the user first signs in."
					},
					"response": []
				},
				{
					"name": "/user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const { channelResourceId } = JSON.parse(responseBody);",
									"",
									"if (channelResourceId) {",
									"    pm.environment.set('channelResourceId', channelResourceId);",
									"}",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiBaseUrl}}/user",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"user"
							]
						},
						"description": "This endpoint fetches a set of fields stored in the DynamoDB table for the authenticated user.\n\nThe response will contain the `channelResourceId` which is required for other endpoints. Alternatively, Postman will set this variable to your environment after a successful response."
					},
					"response": []
				},
				{
					"name": "/user/username/update",
					"request": {
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"newUsername\": \"not{{username}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{apiBaseUrl}}/user/username/update",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"user",
								"username",
								"update"
							]
						},
						"description": "This endpoint will update the username for a user."
					},
					"response": []
				},
				{
					"name": "/user/preferences/update",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const { avatar, color } = JSON.parse(responseBody);",
									"",
									"if (avatar) {",
									"    pm.environment.set('avatar', avatar);",
									"}",
									"",
									"if (color) {",
									"    pm.environment.set('color', color);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"avatar\": \"not{{avatar}}\",\n    \"color\": \"not{{color}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{apiBaseUrl}}/user/preferences/update",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"user",
								"preferences",
								"update"
							]
						}
					},
					"response": []
				},
				{
					"name": "/user/password/reset",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{userEmail}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{apiBaseUrl}}/user/password/reset",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"user",
								"password",
								"reset"
							]
						},
						"description": "This endpoint starts a forgot password flow, which will send an email to the account holder containing a link to reset their password.\n\nIf the email is not associated with an existing account, no further action is taken."
					},
					"response": []
				},
				{
					"name": "/user",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{apiBaseUrl}}/user",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"user"
							]
						},
						"description": "This endpoint will delete all of the resources associated with the corresponding user account, along with the Cognito user account itself."
					},
					"response": []
				}
			],
			"description": "This API serves the purpose of creating new users and providing operations to manage their account information and associated AWS resources, such as their IVS channel and chat room resources.\n\nSome of the operations in this API are supplemented by the [Cognito Identity SDK](https://www.npmjs.com/package/amazon-cognito-identity-js), which we use on the frontend.\n\nYou'll find more information about each endpoint in its corresponding documentation. Some endpoints require the use of an Access Token, which you will get after signing in a user, either by using the Cognito Identity SDK or by using the AWS CLI command provided below.\n\n### Helper Commands\n\nThe following commands are provided for convenience if you want to make API requests without using the Cognito Identity SDK. You will get the Cognito client ID as part of the output of the stack.\n\n#### Authenticate the newly created user\n\n``` shell\naws cognito-idp initiate-auth --client-id  --auth-parameters USERNAME=,PASSWORD= --auth-flow USER_PASSWORD_AUTH --client-metadata submittedUsername=\n\n```\n\nThis command will give you an `AccessToken`, paste its value in the corresponding environment variable attached to this collection.\n\n#### Verify the email for a newly registered user\n\n``` shell\naws cognito-idp confirm-sign-up --client-id  --username  --confirmation-code \n\n```\n\nYou will find the `confirmation-code` in the confirmation email sent upon registration. This is only required when you deploy the stack with the `prod` stage configuration.\n\n#### Completing a forgot password flow\n\n``` shell\naws cognito-idp confirm-forgot-password --client-id  --username  --confirmation-code  --password \n\n```\n\nYou will find `confirmation-code` in the confirmation email sent by calling the `/user/password/reset` endpoint.",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Metrics",
			"item": [
				{
					"name": "/metrics/:channelResourceId/streamSessions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const { nextToken, streamSessions } = JSON.parse(responseBody);",
									"",
									"if (streamSessions.length > 0) {",
									"  pm.environment.set('streamSessionId', streamSessions[0].streamId);",
									"}",
									"",
									"if (nextToken) {",
									"    pm.environment.set('nextToken', nextToken);",
									"} else {",
									"    pm.environment.set('nextToken', '');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiBaseUrl}}/metrics/:channelResourceId/streamSessions?nextToken={{nextToken}}",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"metrics",
								":channelResourceId",
								"streamSessions"
							],
							"query": [
								{
									"key": "nextToken",
									"value": "{{nextToken}}"
								}
							],
							"variable": [
								{
									"key": "channelResourceId",
									"value": "{{channelResourceId}}"
								}
							]
						},
						"description": "This endpoint will return a list of all the past and present streams.\n\nEvery stream session object in the list will contain a `streamId` which is required for other endpoints. Alternatively, Postman will set the latest stream's ID to your environment after a successful response."
					},
					"response": []
				},
				{
					"name": "/metrics/:channelResourceId/streamSessions/:streamSessionId",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{apiBaseUrl}}/metrics/:channelResourceId/streamSessions/:streamSessionId",
							"host": [
								"{{apiBaseUrl}}"
							],
							"path": [
								"metrics",
								":channelResourceId",
								"streamSessions",
								":streamSessionId"
							],
							"variable": [
								{
									"key": "channelResourceId",
									"value": "{{channelResourceId}}"
								},
								{
									"key": "streamSessionId",
									"value": "{{streamSessionId}}"
								}
							]
						},
						"description": "This endpoint gets metadata and CloudWatch metrics data of a specified stream. The metadata includes start and end time, the ingest configuration and the truncated stream events.\n\nThe metrics include the Video Bitrate, the Frame Rate and the average Keyframe Interval will be returned.\n\nThe metrics data will be an array of `FormattedMetricData` objects:\n\n``` typescript\ntype FormattedMetricData = {\n  data: { timestamp: Date; value: number }[];\n  label: string;\n};\n\n```"
					},
					"response": []
				}
			],
			"description": "This API serves the purpose of fetching stream related data and CloudWatch metrics.\n\nAll of the endpoints in this API are authenticated using the same Access Token used to call authenticated User Management endpoints.",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		}
	],
	"auth": {
		"type": "oauth2",
		"oauth2": [
			{
				"key": "grant_type",
				"value": "password_credentials",
				"type": "string"
			},
			{
				"key": "headerPrefix",
				"value": "",
				"type": "string"
			},
			{
				"key": "tokenType",
				"value": "",
				"type": "string"
			},
			{
				"key": "accessToken",
				"value": "{{accessToken}}",
				"type": "string"
			},
			{
				"key": "addTokenTo",
				"value": "header",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}